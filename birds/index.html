<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bird of the Day</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            /* Aligns horizontally */
            align-items: center;
            /* Aligns vertically */
            flex-direction: column;
            /* Stacks flex items vertically */
            padding: 20px;
            min-height: 100vh;
            /* Full viewport height */
            margin: 0;
            /* Removes default margin */
            background-color: black;
        }

        .hero {
            /* Add any specific styling you need for .hero here */
            /* If your hero content is pushing to the top, you might want to adjust or remove this */
            margin-top: 20px;
        }

        #birdOfTheDay {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 20px;
        }

        .placeholder {
            text-align: center;
            color: #666;
            margin-top: 20px;
        }

        .footer-container {
            width: 100%;
        }
    </style>
</head>

<body>
    <header>
        <!-- SVG Menu Toggle with ARIA Label for Accessibility -->
        <svg viewBox="0 0 800 600" id="menuToggle" aria-label="Menu toggle">
            <path d="M300,220 C300,220 520,220 540,220 C740,220 640,540 520,420 C440,340 300,200 300,200"
                class="top_bar">
            </path>
            <path d="M300,320 L540,320" class="middle_bar"></path>
            <path d="M300,210 C300,210 520,210 540,210 C740,210 640,530 520,410 C440,330 300,190 300,190"
                class="bottom_bar" transform="translate(480, 320) scale(1, -1) translate(-480, -318)"></path>
        </svg>
    </header>

    <nav id="fullScreenNav" class="fullscreen-nav">
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/flora/index.html">Plants</a></li>
            <li><a href="/birds/index.html">Birds</a></li>
            <li><a href="/nasa/index.html">APOD</a></li>
            <li><a href="https://www.linkedin.com/in/josmond/">LinkedIn</a></li>
        </ul>
    </nav>

    <div class="hero">
        <h1 class="animated-text">Birds</h1>
        <p>Notable bird sightings in Minnesota and Wisconsin</p>
    </div>

    <div id="birdOfTheDay">
        <!-- Bird details and image will be inserted here -->
    </div>

    <footer class="footer-container">
        <div class="footer">
            <span class="copyright" id="copyright">
                <!-- Copyright text will be inserted here -->
            </span>
        </div>
    </footer>

    <script>
        // Menu toggle functionality
        const menuToggle = document.getElementById("menuToggle");
        const nav = document.getElementById("fullScreenNav");
        menuToggle.addEventListener("click", function () {
            this.classList.toggle("open");
            nav.classList.toggle("show");
            const menuItems = nav.querySelectorAll("li");
            menuItems.forEach((item, index) => {
                item.style.animation = nav.classList.contains("show") ? `slideIn 0.5s ease forwards ${index * 0.1}s` : "";
            });
        });

        // Set copyright text dynamically
        const year = new Date().getFullYear();
        const month = new Date().toLocaleString("default", { month: "long" });
        const day = new Date().getDate();
        document.getElementById("copyright").innerText = `Â© ${day} ${month} ${year}`;

        // Initialize animations
        function initAnimations() {
            const animatedText = document.querySelector(".animated-text");
            animatedText.addEventListener("click", function () {
                this.style.animation = "clickEffect 1s ease forwards";
            });
        }
        initAnimations();

        // Fetch Bird of the Day from eBird API
        var myHeaders = new Headers();
        myHeaders.append("X-eBirdApiToken", "rf0vdjnper7m"); // Replace with your actual eBird API key

        async function fetchBirdOfTheDay() {
            try {
                const response = await fetch("https://api.ebird.org/v2/data/obs/US-MN/recent/notable", {
                    method: 'GET',
                    headers: myHeaders,
                    redirect: 'follow'
                });
                const data = await response.json();
                if (data.length > 0) {
                    const birdOfTheDay = data[Math.floor(Math.random() * data.length)];
                    displayBird(birdOfTheDay);
                    fetchBirdImageFromCommons(birdOfTheDay.comName, birdOfTheDay.speciesCode, () => {
                        // Callback function to append location and date after the image
                        const container = document.getElementById('birdOfTheDay');
                        const locationPara = document.createElement('p');
                        locationPara.textContent = `Location: ${birdOfTheDay.locName}`;
                        const datePara = document.createElement('p');
                        datePara.textContent = `Date: ${birdOfTheDay.obsDt}`;
                        container.appendChild(locationPara);
                        container.appendChild(datePara);
                    });
                }
            } catch (error) {
                console.log('Error fetching Bird of the Day:', error);
            }
        }

        // Fetch bird image from Wikimedia Commons
        async function fetchBirdImageFromCommons(birdName, speciesCode, callback) {
            const searchUrl = `https://commons.wikimedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(birdName)}&srnamespace=6&format=json&origin=*`;
            try {
                const response = await fetch(searchUrl);
                const data = await response.json();
                if (data.query.search.length > 0) {
                    const title = data.query.search[0].title;
                    const imageUrl = `https://commons.wikimedia.org/wiki/Special:FilePath/${encodeURIComponent(title.replace('File:', ''))}`;
                    const imgElement = document.createElement('img');
                    imgElement.src = imageUrl;
                    imgElement.alt = 'Bird image';
                    // Create a link to the eBird species page using the species code
                    const link = document.createElement('a');
                    link.href = `https://ebird.org/species/${speciesCode}`;
                    link.target = '_blank'; // Open link in new tab
                    link.appendChild(imgElement);
                    document.getElementById('birdOfTheDay').appendChild(link);
                    if (typeof callback === "function") callback(); // Execute the callback after the image is appended
                } else {
                    const container = document.getElementById('birdOfTheDay');
                    const placeholderMsg = document.createElement('p');
                    placeholderMsg.classList.add('placeholder');
                    placeholderMsg.textContent = 'Image not available';
                    container.appendChild(placeholderMsg);
                }
            } catch (error) {
                console.error('Error fetching image:', error);
            }
        }

        // Display bird details
        function displayBird(bird) {
            const container = document.getElementById('birdOfTheDay');
            container.innerHTML = `<h3>${bird.comName}</h3><h4>${bird.sciName}</h4>`;
            // Image and additional info will be appended via fetchBirdImageFromCommons
        }

        fetchBirdOfTheDay();
    </script>

</body>

</html>